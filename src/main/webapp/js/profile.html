<!doctype html>
<html lang="en">
<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

    <script src="common.js"></script>

	<title>TimeRec: User profile</title>
</head>
<body>

<nav id="navMenuContainer" style="background-color: #e3f2fd; display:block; height: 56px;"></nav>

<!-- CONTENT -->
<div class="container">
    <h1>Edit User Profile</h1>
  	<hr>
	<div class="row">
      <!-- left column -->
      <div class="col-md-3">
        <div class="text-center" style="display:none">
          <input id="uImageId" class="form-control" type="hidden">
          <img width="256" height="256" src="img/service.jpg" class="avatar img-circle" alt="User photo">
          <br/><br/>
          <input type="file" class="form-control">
        </div>
      </div>
      
      <!-- edit form column -->
      <div class="col-md-9 personal-info">
        <div id="alertMessage"></div>
        <h3>Personal info</h3>

        <form class="form-horizontal" role="form">
          <div class="form-group">
            <label class="col-lg-3 control-label">Name:</label>
            <div class="col-lg-8">
              <input id="uName" class="form-control" type="text">
            </div>
          </div>
          <div class="form-group">
            <label class="col-lg-3 control-label">Email:</label>
            <div class="col-lg-8">
              <input id="uEmail" class="form-control" type="text">
            </div>
          </div>
          <div class="form-group" style="display:none">
            <label class="col-lg-3 control-label">Time Zone:</label>
            <div class="col-lg-8">
              <div class="ui-select">
                <input id="uTzId" class="form-control" type="hidden">
                <select id="uTZ" class="form-control">
                  <option value="UTC+2">(UTC +2) Kaliningrad</option>
                  <option value="UTC+3" selected="selected">(UTC +3) Moscow</option>
                  <option value="UTC+4">(UTC +4) Samara</option>
                  <option value="UTC+5">(UTC +5) Yekaterinburg</option>
                  <option value="UTC+6">(UTC +6) Omsk</option>
                  <option value="UTC+7">(UTC +7) Krasnoyarsk, Novosibirsk</option>
                  <option value="UTC+8">(UTC +8) Irkutsk</option>
                  <option value="UTC+9">(UTC +9) Yakutsk, Chita</option>
                  <option value="UTC+10">(UTC +10) Vladivostok</option>
                  <option value="UTC+11">(UTC +11) Magadan, Sakhalinsk, Srednekolymsk</option>
                  <option value="UTC+12">(UTC +12) Anadyr, Petropavlovsk-Kamchatsky</option>
                </select>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="col-md-3 control-label">Password:</label>
            <div class="col-md-8">
              <input id="uPassword1" class="form-control" type="password">
            </div>
          </div>
          <div class="form-group">
            <label class="col-md-3 control-label">Confirm password:</label>
            <div class="col-md-8">
              <input id="uPassword2" class="form-control" type="password">
            </div>
          </div>
          <div class="form-group">
            <label class="col-md-3 control-label"></label>
            <div class="col-md-8">
              <input type="button" class="btn btn-primary" value="Save Changes" onclick="postData(); return false;">
              <span></span>
              <input type="reset" class="btn btn-default" value="Cancel" onclick="getData(); return false;">
            </div>
          </div>
        </form>
      </div>
  </div>
</div>
<script>

API_URL = "/timerec/api/" + "profile/";

function validateEmail(email) {
  var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
  return re.test(email);
}

function getData() {
	var url = API_URL + "?_=" + (new Date()).getTime();
	getAjaxJson({
		url: url,
		done: function( data ) {
			$( "#uName" ).val( data.name );
			$( "#uEmail" ).val( data.email );
			$( "#uPassword1" ).val( "" );
			$( "#uPassword2" ).val( "" );
			$( "#uImageId" ).val( data.image_id );
			$( "#uTzId" ).val( data.tz_id );
			$( ".container" ).show();
		}
	});
}

function checkData() {
	alertMessageHide();
	name = $("#uName").val();
	email = $( "#uEmail" ).val();
	pas1 = $( "#uPassword1" ).val();
	pas2 = $( "#uPassword2" ).val();

	if( !( name ) ) {
		alertMessage( "''Name'' must be set" );
		return false;
	}
	if( name.length < 3 ) {
		alertMessage( "Minimum ''Name'' length is 3 symbols" );
		return false;
	}
	if( !( pas1 == pas2 ) ) {
		alertMessage( "''Passwords'' must be equal" );
		return false;
	}
    if( !( pas1 == pas2 ) ) {
		alertMessage( "''Passwords'' must be equal" );
		return false;
	}
	if ( !validateEmail( email ) ) {
		alertMessage( "''Email'' is not valid" );
		return false;
	}

	return true;
}

function postData() {
	if( !checkData() ) return false;
	getAjaxJson({
		method: "PUT",
		url: API_URL,
		data: JSON.stringify({
			name: $("#uName").val(),
			email: $("#uEmail").val(),
			password: $("#uPassword1").val(),
			image_id: $("#uImageId").val(),
			tz_id: $("#uTzId").val(),
		}),
		done: function( data ) {
			alertMessage( "Profile saved successfully" );
		}
	})
}

document.addEventListener( 'DOMContentLoaded', function(){ getData() } );
</script>
<!-- /CONTENT -->

<hr>
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
</body>
</html>